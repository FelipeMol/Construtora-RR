<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Teste Edi√ß√£o Local</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
        .modal.show { display: flex !important; }
        .modal-content { background: white; padding: 30px; border-radius: 10px; min-width: 500px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #2196f3; color: white; }
        .btn-danger { background: #f44336; color: white; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #2196f3; color: white; }
        .toast { position: fixed; top: 20px; right: 20px; padding: 15px 20px; background: #4caf50; color: white; border-radius: 5px; display: none; }
        .toast.show { display: block; }
    </style>
</head>
<body>
    <h1>üß™ Teste de Edi√ß√£o - Empresas</h1>
    
    <table id="tabela-empresas">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>CNPJ</th>
                <th>Tipo</th>
                <th>A√ß√µes</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- Modal de Edi√ß√£o -->
    <div id="modal-editar-empresa" class="modal">
        <div class="modal-content">
            <h2>‚úèÔ∏è Editar Empresa</h2>
            <form id="form-editar-empresa" onsubmit="salvarEdicaoEmpresa(event)">
                <input type="hidden" id="edit-empresa-id">
                
                <div class="form-group">
                    <label for="edit-empresa-nome">Nome da Empresa</label>
                    <input type="text" id="edit-empresa-nome" required>
                </div>
                
                <div class="form-group">
                    <label for="edit-empresa-cnpj">CNPJ</label>
                    <input type="text" id="edit-empresa-cnpj">
                </div>
                
                <div class="form-group">
                    <label for="edit-empresa-tipo">Tipo</label>
                    <select id="edit-empresa-tipo" required>
                        <option value="Construtora">Construtora</option>
                        <option value="Subempreiteira">Subempreiteira</option>
                        <option value="Fornecedor">Fornecedor</option>
                        <option value="Outro">Outro</option>
                    </select>
                </div>
                
                <div>
                    <button type="submit" class="btn btn-primary">üíæ Salvar Altera√ß√µes</button>
                    <button type="button" class="btn btn-danger" onclick="fecharModalEmpresa()">‚ùå Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // Dados fake para teste
        let empresas = [
            { id: 1, nome: 'Construtora ABC', cnpj: '12.345.678/0001-90', tipo: 'Construtora' },
            { id: 2, nome: 'Subempreiteira XYZ', cnpj: '98.765.432/0001-10', tipo: 'Subempreiteira' },
            { id: 3, nome: 'Fornecedor 123', cnpj: '11.222.333/0001-44', tipo: 'Fornecedor' }
        ];

        // Renderizar tabela
        function renderizarTabela() {
            const tbody = document.querySelector('#tabela-empresas tbody');
            tbody.innerHTML = '';
            
            empresas.forEach(emp => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${emp.id}</td>
                    <td>${emp.nome}</td>
                    <td>${emp.cnpj}</td>
                    <td>${emp.tipo}</td>
                    <td>
                        <button class="btn btn-primary" onclick="editarEmpresa(${emp.id})">‚úèÔ∏è Editar</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Abrir modal de edi√ß√£o
        function editarEmpresa(id) {
            console.log('‚úèÔ∏è Abrindo modal para editar empresa:', id);
            
            const empresa = empresas.find(e => e.id === id);
            
            if (!empresa) {
                alert('Empresa n√£o encontrada');
                return;
            }
            
            // Preencher modal
            document.getElementById('edit-empresa-id').value = empresa.id;
            document.getElementById('edit-empresa-nome').value = empresa.nome;
            document.getElementById('edit-empresa-cnpj').value = empresa.cnpj || '';
            document.getElementById('edit-empresa-tipo').value = empresa.tipo || 'Construtora';
            
            // Abrir modal
            const modal = document.getElementById('modal-editar-empresa');
            modal.classList.add('show');
            
            console.log('‚úÖ Modal aberto com sucesso');
        }

        // Fechar modal
        function fecharModalEmpresa() {
            console.log('Fechando modal...');
            const modal = document.getElementById('modal-editar-empresa');
            modal.classList.remove('show');
        }

        // Salvar edi√ß√£o
        function salvarEdicaoEmpresa(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('edit-empresa-id').value);
            const nome = document.getElementById('edit-empresa-nome').value.trim();
            const cnpj = document.getElementById('edit-empresa-cnpj').value.trim();
            const tipo = document.getElementById('edit-empresa-tipo').value;
            
            console.log('üíæ Salvando:', { id, nome, cnpj, tipo });
            
            // Atualizar array
            const index = empresas.findIndex(e => e.id === id);
            if (index !== -1) {
                empresas[index] = { id, nome, cnpj, tipo };
                console.log('‚úÖ Empresa atualizada no array');
            }
            
            // Mostrar toast
            mostrarToast('Empresa atualizada com sucesso! ‚úÖ');
            
            // Fechar modal
            fecharModalEmpresa();
            
            // Atualizar tabela
            renderizarTabela();
        }

        function mostrarToast(mensagem) {
            const toast = document.getElementById('toast');
            toast.textContent = mensagem;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Inicializar
        renderizarTabela();
        console.log('‚úÖ Teste carregado. Clique em Editar para testar.');
    </script>
</body>
</html>
